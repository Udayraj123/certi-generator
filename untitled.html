<html moznomarginboxes="" mozdisallowselectionprint=""><head>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap  -->
  <link rel="stylesheet" href="assets/css/bootstrap.css">
  <!-- Styling for this page -->
  <link rel="stylesheet" href="main.css">
  <!-- jQuery -->
  <script src="assets/js/jquery.min.js"></script>
  <!-- Bootstrap -->
  <script src="assets/js/bootstrap.min.js"></script>
  
  <style>
  /*
TODO : 
Flow : Load image;

// Drag Text and Print
// Add/Remove Texts (with close button)
// Put contenteditable- Replace textareas;
Process before print: Maybe disable events if its too laggy?
From an Hardcoded array
Upload from CSV
From Text area.
Font Sizes!

WSIWYG! -> Live move the textfields on all pages!

Nope, Do margins instead- Setting the image height/width
A Grid (invisible in print)
Toggle Sidebar Controls
Selecting Font 
Some opacity and styling
Toggles for UI - Text-centre, 
Fine adjustments by Arrow keys
*/
</style>

</head>

<body>
  <div class="row">
    <div class="no-print col-md-3">
      <div class="upload-btn-wrapper">
        <button class="btn">Load Template</button>
        <input type="file" id="browse">
      </div>
      <hr>
      <div class="upload-btn-wrapper">
        <div id="static-btn-grp">
          <button class="btn createText"> Add Text Field </button>
        <button class="btn select-text" data-id="text1">text1&emsp;<span class="close">X</span></button><button class="btn selected select-text" data-id="text2">text2&emsp;<span class="close">X</span></button></div>
      </div>
      <hr>
      <div class="upload-btn-wrapper">
        <button class="btn" style="color: maroon" onclick="window.location.href+=''"> Reset </button>
      </div>
    </div>

    <div class="col-md-9">
      <div class="full-page-print" id="field" style="width: 1493px; height: 959px;">
        <div id="text1" class="textDiv" style="left: 209px; top: 183px; border: 1px solid; background: rgb(0, 255, 0);"><p class="certiText" style="width:100px" contenteditable="true">text1</p></div><div id="text2" class="textDiv" style="left: 421px; top: 463px; border: 1px solid; background: yellow;"><p class="certiText" style="width:100px" contenteditable="true">text2</p></div><img id="dummy" alt="Please click 'Load Template' to add your template.">
      </div>
    <br><div class="full-page-print" id="field1" style="width: 1493px; height: 959px;">
        <div id="text1" class="textDiv" style="left: 209px; top: 183px; border: 1px solid; background: rgb(0, 255, 0);"><p class="certiText" style="width:100px" contenteditable="true">text-1-1</p></div><div id="text2" class="textDiv" style="left: 421px; top: 463px; border: 1px solid; background: yellow;"><p class="certiText" style="width:100px" contenteditable="true">text-1-2</p></div><img id="dummy" alt="Please click 'Load Template' to add your template.">
      </div><br><div class="full-page-print" id="field2" style="width: 1493px; height: 959px;">
        <div id="text1" class="textDiv" style="left: 209px; top: 183px; border: 1px solid; background: rgb(0, 255, 0);"><p class="certiText" style="width:100px" contenteditable="true">text-2-1</p></div><div id="text2" class="textDiv" style="left: 421px; top: 463px; border: 1px solid; background: yellow;"><p class="certiText" style="width:100px" contenteditable="true">text-2-2</p></div><img id="dummy" alt="Please click 'Load Template' to add your template.">
      </div><br><div class="full-page-print" id="field3" style="width: 1493px; height: 959px;">
        <div id="text1" class="textDiv" style="left: 209px; top: 183px; border: 1px solid; background: rgb(0, 255, 0);"><p class="certiText" style="width:100px" contenteditable="true">text-3-1</p></div><div id="text2" class="textDiv" style="left: 421px; top: 463px; border: 1px solid; background: yellow;"><p class="certiText" style="width:100px" contenteditable="true">text-3-2</p></div><img id="dummy" alt="Please click 'Load Template' to add your template.">
      </div></div>
    
  </div>

  <script>
    var globalScreenWidth = window.innerWidth;
    var globalScreenHeight = window.innerHeight;
    var TextData = [
    ['text-1-1','text-1-2','text-1-3'],
    ['text-2-1','text-2-2','text-2-3'],
    ['text-3-1','text-3-2','text-3-3'],
    ];

    /*
  M1 - Use selector to loop on text inputs. And on those indices put the corresponding text. Should do.
  Outer loop would still be on the rows.

  Problem of absolute positions: Clones don't follow take down their
  */
  var processedOnce=0;
  function doPrint(TextData){
    if(processedOnce==0){

      processedOnce = 1;
      var parent = $('#field').parent();
      TextData.forEach(function(row,row_no){
        var clonedDiv = $('#field').clone();
        field_id="field" + (row_no + 1);
        clonedDiv.attr("id", field_id);
        parent.append("<br>");
        parent.append(clonedDiv);
        allCertiTexts = $('#'+field_id +' .certiText');
      // console.log(row_no);
      // console.log(allCertiTexts);
      allCertiTexts.each(function(i,e){
        e.innerHTML = TextData[row_no][i];
        console.log(e.innerHTML);
      });

      
      allTextDivs = $('#'+field_id +' .textDiv');
      allTextDivs.each(function(i,e){
        currTop = $(e).position().top;// currTop = parseFloat($(e).css('top'));
        // $(e).css('top',currTop + row_no*globalScreenHeight);
        console.log(currTop + row_no*globalScreenHeight);
      });
      
    });
  // $('#field').remove();
}
}
</script>

<script src="handle-img-upload.js"></script>

<script>


  var text_counter=1;
  var ball;
  field = document.getElementById("field");
  field.style.width = globalScreenWidth+"px"; 
  field.style.height = globalScreenHeight+"px"; 

  function focusBall(this_id){
    if(typeof ball !== "undefined"){
      ball.style.background="#00FF00";
    }
    ball = document.getElementById(this_id);
    ball.style.background="yellow";
  }

  function createText()
  {
      // field.style.cursor="pointer";
      this_id = "text" + text_counter++;      
      $('.select-text').removeClass('selected');

      selectButton='<button class="btn selected select-text" data-id="'+this_id+'" >'+this_id+
      '&emsp;<span class="close">X</span>'+'</button>';
      $('#static-btn-grp').append(selectButton);
      // textInput = '<input type="text" value="'+this_id+'">';
      textInput = '<p class="certiText" style="width:100px" contenteditable="true">'+this_id+'</p>';

      textDiv = document.createElement('div');
      textDiv.id=this_id;
      textDiv.className="textDiv";
      textDiv.style.left="1%";
      textDiv.style.top="1%";
      textDiv.style.border="solid 1px";
      textDiv.innerHTML = textInput;
      // field.appendChild(textDiv);
      // textDiv.insertBefore($('#dummy'));
      $('#dummy').before(textDiv);
      // console.log(this_id);
      focusBall(this_id);
      // console.log(textDiv);
    }    
    // createText();
    $(function() {

      $("#static-btn-grp").on('click','.createText',function(event) {
        createText();
      });

      $("#static-btn-grp").on('click','.select-text',function(event) {
        // you've not clicked on a descendant (like the close button).
        if (event.target !== this)
          return;
        $('.select-text').removeClass('selected');
        $(this).addClass('selected');
        this_id=$(this).attr('data-id');
        // console.log(this_id);
        focusBall(this_id);
      });

      $("#static-btn-grp").on('click','.close',function(event) {
        parent=$(this).parent();
        this_id=$(parent).attr('data-id');
        $('#'+this_id).remove();
        parent.remove();
      });   
    });   

    field.onclick = function(event) {

      // window-relative field coordinates
      let fieldCoords = this.getBoundingClientRect();

      // the ball has position:absolute, the field: position:relative
      // so ball coordinates are relative to the field inner left-upper corner
      let ballCoords = {
        top: event.clientY - fieldCoords.top - field.clientTop - ball.clientHeight / 2,
        left: event.clientX - fieldCoords.left - field.clientLeft - ball.clientWidth / 2
      };
      // TODO: Take these up from Arrow keys as well

      // prevent crossing the top field boundary
      if (ballCoords.top < 0) ballCoords.top = 0;

      // prevent crossing the left field boundary
      if (ballCoords.left < 0) ballCoords.left = 0;

      // // prevent crossing the right field boundary
      if (ballCoords.left + ball.clientWidth > field.clientWidth) {
        ballCoords.left = field.clientWidth - ball.clientWidth;
      }

      // prevent crossing the bottom field boundary
      if (ballCoords.top + ball.clientHeight > field.clientHeight) {
        ballCoords.top = field.clientHeight - ball.clientHeight;
      }

      ball.style.left = ballCoords.left + 'px';
      ball.style.top = ballCoords.top + 'px';
    }
  </script>


</body></html>