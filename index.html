<!DOCTYPE html>
<!-- saved from url=(0080)file:///C:/Users/Udayraj021/Desktop/webdworkshop/Session%203/Foottextbox/index.html -->
<html moznomarginboxes mozdisallowselectionprint>
<head>
  <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
  <!-- Bootstrap  -->
  <link rel="stylesheet" href="assets/css/bootstrap.css">
  <!-- Styling for this page -->
  <link rel="stylesheet" href="main.css">
  <!-- Fonts (Moved in main.css file) -->

  <!-- jQuery -->
  <script src="assets/js/jquery.min.js"></script>
  <!-- Bootstrap -->
  <script src="assets/js/bootstrap.min.js"></script>
  <!-- Color Picker -->
  <link rel="stylesheet" href="./assets/colourpicker/css/colourpicker.css">
</head>

<body>
  <div class="row">
    <div class="no-print col-md-3">
      <div class="upload-btn-wrapper">
        <button class="btn">Load Template</button>
        <input type="file" id="browse" />
      </div>
      <hr>
      <div class="upload-btn-wrapper">
        <div id="static-btn-grp">
          <button class="btn createText"> Add Text Field </button>
        </div>
      </div>
      <hr>
      <div class="upload-btn-wrapper">
        <button class="btn" style="color: maroon" onclick="window.location.href+=''"> Reset All </button>
      </div>
      <hr>
      <div class="upload-btn-wrapper">
       <h4> <b>Change Font</b>
         <button class="btn btn-tiny" style="color: maroon" onclick="makeSizer(2.5)"> + </button>
         <button class="btn btn-tiny" style="color: maroon" onclick="makeSizer(-2.5)"> - </button>
       </h4>
       <select id='font-select' onChange = "return fontChange();"> </select>
     </div>
     <p>
      <input id="titler" type="colour" placeholder="brown" value="black" aria-label="Header Colour">
    </p>
    <hr>
    <div class="upload-btn-wrapper">
      <button class="btn" style="color: maroon" onclick="doPrint(TextData)"> Print </button>
    </div>
    <hr>
    <div class="upload-btn-wrapper">
      <button class="btn btn-tiny" style="color: maroon"> <a target="_blank" href="https://www.youtube.com/watch?v=ZfrQRjsW6oU"> Alternative (using MS Word) </a></button>
    </div>
    <hr>
  </div>

  <!-- Main play area -->
  <div class="col-md-9">
    <div class="full-page-print" id="field">
      <img id="dummy" style="position: relative; top: 0px; left:0px;height: 100%;width: 100%" alt="Please click 'Load Template' to add your template." >
    </div>
  </div>

</div>

<script type="text/javascript">
// Utilities
$.fn.exists = function () {
  return this.length !== 0;
}
</script>
<script src="./assets/js/font-select.js"></script>
<script type="text/javascript">
  // For font change
  var textSelector = ".certiText";
  var fontSelect = document.getElementById("font-select");
  function fontChange(){
    if($(textSelector).exists()){
      var x = fontSelect.selectedIndex;
      var y = fontSelect.options;
      $(textSelector).css("font-family",y[x].value);
    }  
  }  
  var fontSizeInt=20;// default font size
  function makeSizer(size) {
    if($(textSelector).exists()){
      fontSizeInt = parseFloat($(textSelector).css('font-size').replace('px', ''));
      // console.log(fontSizeInt);
      $(textSelector).css('font-size', (fontSizeInt+ size) + 'px');
    }
  }
</script>

<script src="./assets/colourpicker/js/tinycolor.js" ></script>
<script src="./assets/colourpicker/js/colourpicker.js" ></script>
<script>
  var $titlePicker = $('#titler');
  $titlePicker.on('change', function() {
    $(textSelector).css('color', $titlePicker.colourPicker('val'));
    // var $siteHeader  = $(textSelector);
    // if ($titlePicker.colourPicker('isDark')) {
    //   $siteHeader.css('background-color', 'white');
    // } else {
    //   $siteHeader.css('background-color', 'black');
    // }
  }).change();
</script>

<script>

  var globalScreenWidth = window.innerWidth;
  var globalScreenHeight =  window.innerHeight;
  var TextData = [
  ['text-1-1','text-1-2','text-1-3'],
  ['text-2-1','text-2-2','text-2-3'],
  ['text-3-1','text-3-2','text-3-3'],
  ];
  var textboxMarginTop=0;
  var textboxMarginLeft=0;
    /*
  M1 - Use selector to loop on text inputs. And on those indices put the corresponding text. Should do.
  Outer loop would still be on the rows.

  Problem of absolute positions: Clones don't follow take down their
  */
  var processedOnce=0,temp=1;
  function doPrint(TextData){
    if(processedOnce==0){

      processedOnce = 1;
      var parent = $('#field').parent();
      TextData.forEach(function(row,row_no){
        var clonedDiv = $('#field').clone();
        field_id="field" + (row_no + 1);
        clonedDiv.attr("id", field_id);
        // parent.append("<br>");
        parent.append(clonedDiv);
        thisImg = $('#'+field_id +' img');
        thisImg.attr("id","dummy"+temp++);
        // img{display: block; height: 100%;}
        thisImg.css('display','block');
        thisImg.css('height','100%');

        // DEBUG THIS
        allCertiTexts = $('#'+field_id +' .certiText');
      // console.log(row_no);
      // console.log(allCertiTexts);
      allCertiTexts.each(function(i,e){
        e.innerHTML = TextData[row_no][i];
        console.log(e.innerHTML);
      });

      
      allTextDivs = $('#'+field_id +' .textDiv');
      allTextDivs.each(function(i,e){
        $(e).css('border','none');
        currTop = $(e).position().top;// currTop = parseFloat($(e).css('top'));
        $(e).css('top',currTop + row_no*globalScreenHeight);
        console.log(currTop + row_no*globalScreenHeight);
      });
      
    });
      $('#field').remove();
    } else{
      console.log("Already processed input, continuing to print");
    }
// window.print();

}

</script>
<script src="./assets/js/handle-img-upload.js"></script>

<script>


  var text_counter=1;
  var textbox;
  field = document.getElementById("field");
  field.style.width = globalScreenWidth+"px"; 
  field.style.height = globalScreenHeight+"px"; 

  function focusTextBox(this_id){
    if(typeof textbox !== "undefined"){
      textbox.style.background="rgba(1,1,1,0.1)";
    }
    textbox = document.getElementById(this_id);
    textbox.style.background="rgba(1,1,1,0.3)";
  }

  function createText()
  {
      // field.style.cursor="pointer";
      this_id = "column" + text_counter++;      
      $('.select-text').removeClass('selected');

      selectButton='<button class="btn selected select-text" data-id="'+this_id+'" >'+this_id+
      '&emsp;<span class="close">X</span>'+'</button>';
      $('#static-btn-grp').append(selectButton);
      // textInput = '<input class="certiText" type="text" value="'+this_id+'">';
      textInput = '<p class="certiText" style="width:100px;" >'+this_id+'</p>';
      //^ contenteditable="true"

      textDiv = document.createElement('div');
      textDiv.id=this_id;
      textDiv.className="textDiv";
      textDiv.style.left="0.1%";
      textDiv.style.top="0.1%";      
      textDiv.innerHTML = textInput;
      // field.appendChild(textDiv);
      // textDiv.insertBefore($('#dummy'));
      $('#dummy').before(textDiv);
      
      // console.log(this_id);
      // console.log(textDiv);
      // Trigger events
      focusTextBox(this_id);
      $titlePicker.change();
      fontChange();
      makeSizer(0);
    }    
    // createText();
    $(function() {

      $("#static-btn-grp").on('click','.createText',function(event) {
        createText();
      });

      $("#static-btn-grp").on('click','.select-text',function(event) {
        // you've not clicked on a descendant (like the close button).
        if (event.target !== this)
          return;
        $('.select-text').removeClass('selected');
        $(this).addClass('selected');
        this_id=$(this).attr('data-id');
        // console.log(this_id);
        focusTextBox(this_id);
      });

      $("#static-btn-grp").on('click','.close',function(event) {
        parent=$(this).parent();
        this_id=$(parent).attr('data-id');
        $('#'+this_id).remove();
        parent.remove();
      });   
    });   

    field.onclick = function(event) {

      // window-relative field coordinates
      let fieldCoords = this.getBoundingClientRect();

      // the textbox has position:absolute, the field: position:relative
      // so textbox coordinates are relative to the field inner left-upper corner
      let textboxCoords = {
        top: event.clientY - fieldCoords.top - field.clientTop + textboxMarginTop //- textbox.clientHeight / 2
        ,left: event.clientX - fieldCoords.left - field.clientLeft + textboxMarginLeft //- textbox.clientWidth / 2
      };
      // TODO: Take these up from Arrow keys as well

      // prevent crossing the top field boundary
      if (textboxCoords.top < 0) textboxCoords.top = 0;

      // prevent crossing the left field boundary
      if (textboxCoords.left < 0) textboxCoords.left = 0;

      // // prevent crossing the right field boundary
      if (textboxCoords.left + textbox.clientWidth > field.clientWidth) {
        textboxCoords.left = field.clientWidth - textbox.clientWidth;
      }

      // prevent crossing the bottom field boundary
      if (textboxCoords.top + textbox.clientHeight > field.clientHeight) {
        textboxCoords.top = field.clientHeight - textbox.clientHeight;
      }

      textbox.style.left = textboxCoords.left + 'px';
      textbox.style.top = textboxCoords.top + 'px';
    }
  </script>


</body></html>